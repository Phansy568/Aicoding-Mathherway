{"ast":null,"code":"var _jsxFileName = \"D:\\\\BaiduSyncdisk\\\\\\u5927\\u5B66\\\\\\u7ADE\\u8D5B\\u3001\\u9879\\u76EE\\\\AI\\u7F16\\u7A0B\\\\frontend\\\\src\\\\components\\\\KnowledgeGraph\\\\index.tsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef } from 'react';\nimport * as d3 from 'd3';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const KnowledgeGraph = ({\n  data,\n  width,\n  height\n}) => {\n  _s();\n  const svgRef = useRef(null);\n  useEffect(() => {\n    if (!svgRef.current) return;\n\n    // 清除现有内容\n    d3.select(svgRef.current).selectAll(\"*\").remove();\n\n    // 创建力导向图布局\n    const simulation = d3.forceSimulation(data.nodes).force(\"link\", d3.forceLink(data.edges).id(d => d.id).distance(100)).force(\"charge\", d3.forceManyBody().strength(-200)).force(\"center\", d3.forceCenter(width / 2, height / 2));\n    const svg = d3.select(svgRef.current);\n\n    // 绘制边\n    const edges = svg.selectAll(\".edge\").data(data.edges).enter().append(\"g\").attr(\"class\", \"edge\");\n\n    // 添加边的线条\n    edges.append(\"line\").style(\"stroke\", d => getEdgeColor(d.relationship)).style(\"stroke-width\", 2).style(\"stroke-dasharray\", d => getEdgeStyle(d.relationship));\n\n    // 为有向边添加箭头\n    edges.filter(d => isDirectedEdge(d.relationship)).append(\"marker\").attr(\"id\", (d, i) => `arrow-${i}`).attr(\"viewBox\", \"0 -5 10 10\").attr(\"refX\", 15).attr(\"refY\", 0).attr(\"markerWidth\", 6).attr(\"markerHeight\", 6).attr(\"orient\", \"auto\").append(\"path\").attr(\"d\", \"M0,-5L10,0L0,5\").style(\"fill\", d => getEdgeColor(d.relationship));\n\n    // 绘制节点\n    const nodes = svg.selectAll(\".node\").data(data.nodes).enter().append(\"g\").attr(\"class\", \"node\").call(d3.drag().on(\"start\", dragStarted).on(\"drag\", dragged).on(\"end\", dragEnded));\n\n    // 添加节点圆形\n    nodes.append(\"circle\").attr(\"r\", 20).style(\"fill\", d => getColorByCategory(d.category));\n\n    // 添加节点文本\n    nodes.append(\"text\").text(d => d.label).attr(\"text-anchor\", \"middle\").attr(\"dy\", 30);\n\n    // 更新力导向图\n    simulation.on(\"tick\", () => {\n      edges.attr(\"x1\", d => d.source.x).attr(\"y1\", d => d.source.y).attr(\"x2\", d => d.target.x).attr(\"y2\", d => d.target.y);\n      nodes.attr(\"transform\", d => `translate(${d.x},${d.y})`);\n    });\n\n    // 拖拽相关函数\n    function dragStarted(event) {\n      if (!event.active) simulation.alphaTarget(0.3).restart();\n      event.subject.fx = event.subject.x;\n      event.subject.fy = event.subject.y;\n    }\n    function dragged(event) {\n      event.subject.fx = event.x;\n      event.subject.fy = event.y;\n    }\n    function dragEnded(event) {\n      if (!event.active) simulation.alphaTarget(0);\n      event.subject.fx = null;\n      event.subject.fy = null;\n    }\n  }, [data, width, height]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"knowledge-graph bg-white rounded-lg shadow p-4\",\n    children: /*#__PURE__*/_jsxDEV(\"svg\", {\n      ref: svgRef,\n      width: width,\n      height: height\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 111,\n    columnNumber: 5\n  }, this);\n};\n\n// 根据知识点类别返回不同颜色\n_s(KnowledgeGraph, \"89Ty783ABEwsfMbSOeu9vscWF34=\");\n_c = KnowledgeGraph;\nfunction getColorByCategory(category) {\n  const colorMap = {\n    '函数': '#FF6B6B',\n    '几何': '#4ECDC4',\n    '代数': '#45B7D1',\n    '概率统计': '#96CEB4'\n  };\n  return colorMap[category] || '#666';\n}\n\n// 添加辅助函数\nfunction getEdgeColor(relationship) {\n  const colorMap = {\n    'Prerequisite': '#2D3748',\n    'Includes': '#4A5568',\n    'RelatedTo': '#718096',\n    'AppliedIn': '#A0AEC0',\n    'AdvancesTo': '#CBD5E0'\n  };\n  return colorMap[relationship] || '#999';\n}\nfunction getEdgeStyle(relationship) {\n  const styleMap = {\n    'Includes': '5,5',\n    'RelatedTo': '2,2',\n    'default': ''\n  };\n  return styleMap[relationship] || styleMap.default;\n}\nfunction isDirectedEdge(relationship) {\n  const directedTypes = ['Prerequisite', 'Includes', 'AppliedIn', 'AdvancesTo'];\n  return directedTypes.includes(relationship);\n}\nexport default KnowledgeGraph;\nvar _c;\n$RefreshReg$(_c, \"KnowledgeGraph\");","map":{"version":3,"names":["React","useEffect","useRef","d3","jsxDEV","_jsxDEV","KnowledgeGraph","data","width","height","_s","svgRef","current","select","selectAll","remove","simulation","forceSimulation","nodes","force","forceLink","edges","id","d","distance","forceManyBody","strength","forceCenter","svg","enter","append","attr","style","getEdgeColor","relationship","getEdgeStyle","filter","isDirectedEdge","i","call","drag","on","dragStarted","dragged","dragEnded","getColorByCategory","category","text","label","source","x","y","target","event","active","alphaTarget","restart","subject","fx","fy","className","children","ref","fileName","_jsxFileName","lineNumber","columnNumber","_c","colorMap","styleMap","default","directedTypes","includes","$RefreshReg$"],"sources":["D:/BaiduSyncdisk/大学/竞赛、项目/AI编程/frontend/src/components/KnowledgeGraph/index.tsx"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\r\nimport * as d3 from 'd3';\r\nimport { GraphData, KnowledgeNode } from './types';\r\n\r\ninterface KnowledgeGraphProps {\r\n  data: GraphData;\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport const KnowledgeGraph: React.FC<KnowledgeGraphProps> = ({ data, width, height }) => {\r\n  const svgRef = useRef<SVGSVGElement>(null);\r\n\r\n  useEffect(() => {\r\n    if (!svgRef.current) return;\r\n\r\n    // 清除现有内容\r\n    d3.select(svgRef.current).selectAll(\"*\").remove();\r\n\r\n    // 创建力导向图布局\r\n    const simulation = d3.forceSimulation(data.nodes as d3.SimulationNodeDatum[])\r\n      .force(\"link\", d3.forceLink(data.edges)\r\n        .id((d: d3.SimulationNodeDatum) => (d as any).id)\r\n        .distance(100))\r\n      .force(\"charge\", d3.forceManyBody().strength(-200))\r\n      .force(\"center\", d3.forceCenter(width / 2, height / 2));\r\n\r\n    const svg = d3.select(svgRef.current);\r\n\r\n    // 绘制边\r\n    const edges = svg.selectAll(\".edge\")\r\n      .data(data.edges)\r\n      .enter()\r\n      .append(\"g\")\r\n      .attr(\"class\", \"edge\");\r\n\r\n    // 添加边的线条\r\n    edges.append(\"line\")\r\n      .style(\"stroke\", (d: any) => getEdgeColor(d.relationship))\r\n      .style(\"stroke-width\", 2)\r\n      .style(\"stroke-dasharray\", (d: any) => getEdgeStyle(d.relationship));\r\n\r\n    // 为有向边添加箭头\r\n    edges.filter((d: any) => isDirectedEdge(d.relationship))\r\n      .append(\"marker\")\r\n      .attr(\"id\", (d, i) => `arrow-${i}`)\r\n      .attr(\"viewBox\", \"0 -5 10 10\")\r\n      .attr(\"refX\", 15)\r\n      .attr(\"refY\", 0)\r\n      .attr(\"markerWidth\", 6)\r\n      .attr(\"markerHeight\", 6)\r\n      .attr(\"orient\", \"auto\")\r\n      .append(\"path\")\r\n      .attr(\"d\", \"M0,-5L10,0L0,5\")\r\n      .style(\"fill\", (d: any) => getEdgeColor(d.relationship));\r\n\r\n    // 绘制节点\r\n    const nodes = svg.selectAll(\".node\")\r\n      .data(data.nodes)\r\n      .enter()\r\n      .append(\"g\")\r\n      .attr(\"class\", \"node\")\r\n      .call(d3.drag<any, any>()\r\n        .on(\"start\", dragStarted)\r\n        .on(\"drag\", dragged)\r\n        .on(\"end\", dragEnded));\r\n\r\n    // 添加节点圆形\r\n    nodes.append(\"circle\")\r\n      .attr(\"r\", 20)\r\n      .style(\"fill\", (d: KnowledgeNode) => getColorByCategory(d.category));\r\n\r\n    // 添加节点文本\r\n    nodes.append(\"text\")\r\n      .text((d: KnowledgeNode) => d.label)\r\n      .attr(\"text-anchor\", \"middle\")\r\n      .attr(\"dy\", 30);\r\n\r\n    // 更新力导向图\r\n    simulation.on(\"tick\", () => {\r\n      edges\r\n        .attr(\"x1\", (d: any) => d.source.x)\r\n        .attr(\"y1\", (d: any) => d.source.y)\r\n        .attr(\"x2\", (d: any) => d.target.x)\r\n        .attr(\"y2\", (d: any) => d.target.y);\r\n\r\n      nodes\r\n        .attr(\"transform\", (d: any) => `translate(${d.x},${d.y})`);\r\n    });\r\n\r\n    // 拖拽相关函数\r\n    function dragStarted(event: any) {\r\n      if (!event.active) simulation.alphaTarget(0.3).restart();\r\n      event.subject.fx = event.subject.x;\r\n      event.subject.fy = event.subject.y;\r\n    }\r\n\r\n    function dragged(event: any) {\r\n      event.subject.fx = event.x;\r\n      event.subject.fy = event.y;\r\n    }\r\n\r\n    function dragEnded(event: any) {\r\n      if (!event.active) simulation.alphaTarget(0);\r\n      event.subject.fx = null;\r\n      event.subject.fy = null;\r\n    }\r\n  }, [data, width, height]);\r\n\r\n  return (\r\n    <div className=\"knowledge-graph bg-white rounded-lg shadow p-4\">\r\n      <svg\r\n        ref={svgRef}\r\n        width={width}\r\n        height={height}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\n// 根据知识点类别返回不同颜色\r\nfunction getColorByCategory(category: string): string {\r\n  const colorMap = {\r\n    '函数': '#FF6B6B',\r\n    '几何': '#4ECDC4',\r\n    '代数': '#45B7D1',\r\n    '概率统计': '#96CEB4'\r\n  };\r\n  return colorMap[category as keyof typeof colorMap] || '#666';\r\n}\r\n\r\n// 添加辅助函数\r\nfunction getEdgeColor(relationship: string): string {\r\n  const colorMap: Record<string, string> = {\r\n    'Prerequisite': '#2D3748',\r\n    'Includes': '#4A5568',\r\n    'RelatedTo': '#718096',\r\n    'AppliedIn': '#A0AEC0',\r\n    'AdvancesTo': '#CBD5E0'\r\n  };\r\n  return colorMap[relationship] || '#999';\r\n}\r\n\r\nfunction getEdgeStyle(relationship: string): string {\r\n  const styleMap: Record<string, string> = {\r\n    'Includes': '5,5',\r\n    'RelatedTo': '2,2',\r\n    'default': ''\r\n  };\r\n  return styleMap[relationship] || styleMap.default;\r\n}\r\n\r\nfunction isDirectedEdge(relationship: string): boolean {\r\n  const directedTypes = [\r\n    'Prerequisite',\r\n    'Includes',\r\n    'AppliedIn',\r\n    'AdvancesTo'\r\n  ];\r\n  return directedTypes.includes(relationship);\r\n}\r\n\r\nexport default KnowledgeGraph; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}